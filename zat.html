<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Benji Antolin, Bo Zhao">
  <title>Zaatari Refugee Camp (2015)</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/zaatari.css">
  <style>
    .legend {
      line-height: 16px;
      width: 140px;
      color: #333333;
      font-family: 'Open Sans', sans-serif;
      padding: 6px 8px;
      background: white;
      background: rgba(255, 255, 255, 0.5);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
    }
    .legend i {
      width: 16px;
      height: 16px;
      float: left;
      margin-right: 8px;
      opacity: 0.9;
    }
    .legend img {
      width: 16px;
      height: 16px;
      margin-right: 3px;
      float: left;
    }
    .legend p {
      font-size: 12px;
      line-height: 16px;
      margin: 0;
    }
    .fa-mosque:hover {
      opacity: 0.3;
    }
    .fa-mosque {
      color: #8c510a;
      font-size: .5rem;
      position: absolute;
      border: 5px;
      top: 35%;
      left: 50%;
      transform: translate(-50%, -50%);
      -ms-transform: translate(-50%, -50%);
      opacity: 0.8;
      text-shadow: 1px 1px 1px black;
    }
    .control {
      color: #8c510a;
      font-size: 10px;
      position: relative;
      border: 5px;
      top: 35%;
      left: 5%;
      transform: translate(-50%, -50%);
      -ms-transform: translate(-50%, -50%);
      opacity: 0.8;
      text-shadow: 1px 1px 1px black;
    }
    .trash {
      color: #878787;
      font-size: 10px;
      position: relative;
      border: 5px;
      top: 35%;
      left: 5%;
      transform: translate(-50%, -50%);
      -ms-transform: translate(-50%, -50%);
      opacity: 0.8;
      text-shadow: 1px 1px 1px black;
    }
    .fa-trash-alt:hover {
      opacity: 0.3;
    }
    /* .fa-trash-alt {
      color: #878787;
      font-size: 10px;
      position: absolute;
      border: 5px;
      top: 35%;
      left: 50%;
      transform: translate(-50%, -50%);
      -ms-transform: translate(-50%, -50%);
      opacity: 0.8;
      text-shadow: 10px 10px 10px white;
    } */
    /* .mosques {
  color: red;
  opacity: 0.8;
  text-shadow: 1px 1px 1px grey;
} */
    .leaflet-control-layers {
      width: 220px;
    }
  </style>
  <!-- <link rel="icon" href="img/favicon.ico" type="image/x-icon" /> -->
  <script src="https://unpkg.com/d3@5/dist/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v5.min.js"></script> -->
  <script src="https://dc-js.github.io/dc.js/js/crossfilter.js"></script>
  <script src="https://dc-js.github.io/dc.js/js/dc.js"></script>
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <!-- <script src="js/leaflet.heat.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script>
</head>

<body>
  <header>
    <div class="collapse bg-dark" id="navbarHeader">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-8 col-md-7 py-4">
            <h4 class="text-white">About</h4>
            <p class="text-muted">The Za’atari Demographic Coordinated View, created by students at Oregon State University, is a geovisualization of the Za’atari refugee camp in Jordan. <br>
              The project focuses on demographics and time trends in the camp from its opening in 2012 to December 2014.</p>
          </div>
          <div class="col-sm-4 offset-md-1 py-4">
            <h4 class="text-white">Contact</h4>
            <ul class="list-unstyled">
              <li><a href="#" class="text-white">Follow on Twitter</a></li>
              <li><a href="#" class="text-white">Like on Facebook</a></li>
              <li><a href="#" class="text-white">Email me</a></li>
            </ul>
          </div>
        </div>
        <div class="navbar-expand-md navbar-dark bg-dark shadow-sm">
          <ul class="navbar-nav mr-auto">

            <!-- <li class="nav-item">
              <a class="nav-link" href="case1.html">Flood compliants</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="case2.html">Local Changes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="case3.html">Projec Imapcts</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="case4.html">Beaver Activities</a>
            </li> -->
          </ul>
        </div>
      </div>
    </div>

    <div class="navbar navbar-dark bg-dark shadow-sm">
      <div class="container-fluid d-flex justify-content-between">
        <a href="index.html" class="navbar-brand d-flex align-items-center">
          <!-- <img src="img/navbar.png" class="img-responsive" height="30"></img> -->
          <strong>Zaatari Refugee Camp</strong>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>
  </header>
  <main>
    <div class="loader"></div>
    <div id="sidebar">
      <div id="dismiss">
        <i class="fas fa-arrow-left"></i>
      </div>
      <div class="sidebar-header">
        <h3 id="projName">Zaatari Dimensional Charts</h3>
      </div>
      <div id="projDesc">Something short and leading about the collection below—its contents, the creator, etc. Make it short and sweet, but not too short so folks don’t simply skip over it entirely.</div>
      <div id="projImages" class="row col-md-12"></div>

      <div id="class-chart"></div>
      <div id="date-chart"></div>
      <div class="row col-md-12">
        <div id="stock-chart" class="col-md-5"></div>
        <div id="species-chart" class="col-md-5"></div>
      </div>
      <div id="date-chart2"></div>
      <p class="dc-data-count"># Project Items</p>
      <div id="plants" class="row"></div>
      <div id="monitor" class="row"></div>

      <footer>
        <!-- <a href='https://github.com/jakobzhao/storymap'><img src='http://jakobzhao.github.io/storymap/img/logo.png' width='18px' target='_blank' > storymap.js </a> -->
      </footer>
    </div>

    <div id="map"></div>

  </main>

  <div id="info">
    <h4>Zaatari Refugee Camp</h4>
    <p id="caseDesc">The Za’atari refugee camp is located near Mafraq governorate, Jordan and is the largest refugee camp for Syrian refugees, with a peak population of 83,000 individuals in March 2015. The camp opened on July 28th, 2012, near the
      beginning of the Syrian Civil War, which is estimated to have displaced over 10 million Syrians. As of October 2018, the Za’atari camp population is still nearly 80,000 and 20% are children under 5 years old.
    </p>
    <p id="mapFunc">Overall camp administration is coordinated by the Syrian Refugee Affairs Directorate and the United Nations High Commissioner for Refugees (UNHCR) and large funding sums are donated to the camp by the Jordanian government. Many
      other stakeholders exist for camp administration and services including the following (not exhaustive): UNICEF, MercyCorps, Oxfam, World Food Programme, UNESCO, ACTED, and more.
    </p>
    <div id="totpop" style="min-height: 250px"></div>
  </div>

  <script>
    $(window).ready(function() {
      $('.loader').fadeOut("slow");
    });
    var createLabelIcon = function(labelClass, labelText) {
      return L.divIcon({
        className: labelClass,
        html: labelText
      })
    }
    // $(document).ready(function() {
    $("#sidebar").mCustomScrollbar({
      theme: "minimal"
    });
    $('#dismiss').on('click', function() {
      $('#sidebar').removeClass('active');
      $('#info').css('left', '20px');
      // $('.overlay').removeClass('active');
    });
    // });
    // creating sidebar https://bootstrapious.com/p/bootstrap-sidebar
    //1. Create a map object.
    var mymap = L.map('map', {
      center: [32.293, 36.315],
      zoom: 15,
      maxZoom: 18,
      minZoom: 8,
      zoomControl: false,
      detectRetina: true
    });
    L.control.scale({
      position: 'bottomright'
    }).addTo(mymap);
    // 2. Add a base map.
    //L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}@2x.png').addTo(mymap);
    // L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png');
    // var Esri_WorldTopoMap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
    // 	attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community'
    // }).addTo(mymap);
    var gray = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}@2x.png').addTo(mymap);
    var streets = L.tileLayer('http://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}@2x.png');
    var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
    var baseLayers = {
      'Grayscale': gray,
      'Streets': streets,
      'Satellite': satellite
    }
    var districts_group = L.layerGroup().addTo(mymap);
    $.when($.getJSON("assets/mosques.geojson"),
      $.getJSON("assets/overlay/garbageBins.geojson"),
      $.getJSON("assets/districts.geojson"),
      $.getJSON("assets/overlay/roads.geojson"),
      $.getJSON("assets/overlay/septicTanks.geojson"),
      $.getJSON("assets/overlay/pipesSeptic.geojson"),
      $.getJSON("assets/overlay/steelTanks.geojson"),
      $.getJSON("assets/overlay/pipesSolidFree.geojson"),
      $.getJSON("assets/overlay/campFacilitiesAll.geojson"),
    ).done(function(mosques, trash, districts, roads, sepTanks, sepPipes, steelTanks, steelPipes, facilities) {
      var mosquesLayer = L.geoJSON(mosques, {
        onEachFeature: function(feature, layer) {
          layer.bindPopup('<b>Mosque Name: </b>' + feature.properties.NAME_EN)
        },
        pointToLayer: function(feature, latlng) {
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'fas fa-mosque'
            })
          });
        }
      });
      // 4. build up a set of colors from colorbrewer's dark2 category
      var trashColors = chroma.scale('RdYlGn').mode('lch').colors(3);
      for (i = 0; i < 3; i++) {
        $('head').append($("<style> .trash-color-" + (i + 1).toString() + " { color: " + trashColors[i] + "; font-size: 10px; opacity: 0.8; text-shadow: 0 0 3px #636363;} </style>"));
      }
      var trashLayer = L.geoJSON(trash, {
        onEachFeature: function(feature, layer) {
          layer.bindPopup('<b>CONDITION: </b>' + feature.properties.CONDITION)
        },
        pointToLayer: function(feature, latlng) {
          var id = 0;
          if (feature.properties.CONDITION == "replace") {
            id = 0;
          } else if (feature.properties.CONDITION == "maintain") {
            id = 1;
          } else if (feature.properties.CONDITION == "good") {
            id = 2;
          } else {
            id = 3;
          }
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'fas fa-trash-alt trash-color-' + (id + 1).toString(),
            })
          });
        }
      });
      // var facilityColors = chroma.scale('RdYlGn').mode('lch').colors(3);
      // for (i = 0; i < 3; i++) {
      //   $('head').append($("<style> .facility-color-" + (i + 1).toString() + " { color: " + facilityColors[i] + "; font-size: 10px; opacity: 0.8; text-shadow: 0 0 3px #636363;} </style>"));
      // }
      // var facilityLayer = L.geoJSON(trash, {
      //   onEachFeature: function(feature, layer) {
      //     layer.bindPopup('<b>CONDITION: </b>' + feature.properties.CONDITION)
      //   },
      //   pointToLayer: function(feature, latlng) {
      //     var id = 0;
      //     if (feature.properties.CONDITION == "replace") {
      //       id = 0;
      //     } else if (feature.properties.CONDITION == "maintain") {
      //       id = 1;
      //     } else if (feature.properties.CONDITION == "good") {
      //       id = 2;
      //     } else {
      //       id = 3;
      //     }
      //     return L.marker(latlng, {
      //       icon: L.divIcon({
      //         className: 'fas fa-trash-alt trash-color-' + (id + 1).toString(),
      //       })
      //     });
      //   }
      // });
      var sepTanksColors = chroma.scale('blues').colors(4);
      for (i = 0; i < 3; i++) {
        $('head').append($("<style> .sepTanks-color-" + (i + 1).toString() + " { color: " + sepTanksColors[i] + "; font-size: 6px; opacity: 0.8; text-shadow: 0 0 3px #636363;} </style>"));
      }
      var sepTanksLayer = L.geoJSON(sepTanks, {
        onEachFeature: function(feature, layer) {
          layer.bindPopup('<b># of Households Served: </b>' + feature.properties.HOUSE_COUN)
        },
        pointToLayer: function(feature, latlng) {
          var id = 0;
          if (feature.properties.HOUSE_COUN > 15) {
            id = 3;
          } else if (feature.properties.HOUSE_COUN > 10) {
            id = 2;
          } else if (feature.properties.HOUSE_COUN > 5) {
            id = 1;
          } else {
            id = 0;
          }
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'fas fa-box sepTanks-color-' + (id + 1).toString(),
            })
          });
        }
      });
      var sepPipesLayer = L.geoJSON(sepPipes, {
        style: {
          color: "gray",
          weight: 1,
          opacity: .8,
        }
      });
      var steelTanksColors = chroma.scale('greens').colors(4);
      for (i = 0; i < 3; i++) {
        $('head').append($("<style> .steelTanks-color-" + (i + 1).toString() + " { color: " + steelTanksColors[i] + "; font-size: 8px; opacity: 0.8; text-shadow: 0 0 3px #636363;} </style>"));
      }
      var steelTanksLayer = L.geoJSON(steelTanks, {
        onEachFeature: function(feature, layer) {
          layer.bindPopup('<b># of Households Served: </b>' + feature.properties.house_coun)
        },
        pointToLayer: function(feature, latlng) {
          var id = 0;
          if (feature.properties.house_coun > 150) {
            id = 3;
          } else if (feature.properties.house_coun > 100) {
            id = 2;
          } else if (feature.properties.house_coun > 50) {
            id = 1;
          } else {
            id = 0;
          }
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'fas fa-archive steelTanks-color-' + (id + 1).toString(),
            })
          });
        }
      }).addTo(mymap);
      var steelPipesLayer = L.geoJSON(steelPipes, {
        style: {
          color: "gray",
          weight: 1,
          opacity: .8,
        }
      }).addTo(mymap);
      var roadsLayer = L.geoJSON(roads, {
        style: road_style
      });
      var faciltiesLayer = L.geoJSON(facilities, {
        // style: road_style
      }).addTo(mymap);
      //
      //
      // var lable_1080 = L.marker(new L.LatLng(45.4598159837, -122.7889400265), {
      //   icon: createLabelIcon("textLabelclass2", "Greenway ( Proj #.1018)")
      // }).addTo(proj_1080_group);
      //
      //
      // var label_121 = L.marker(new L.LatLng(45.4468159837, -122.7840400265), {
      //   icon: createLabelIcon("textLabelclass2", "Englewood (Proj #. 123)")
      // }).addTo(proj_123_group);
      //
      //
      // var lable_141 = L.marker(new L.LatLng(45.4278159837, -122.7680400265), {
      //   icon: createLabelIcon("textLabelclass2", "HallToAsh (Proj #. 141)")
      // }).addTo(proj_141_group);
      //
      // var lable_6758 = L.marker(new L.LatLng(45.4608159837, -122.7595400265), {
      //   icon: createLabelIcon("textLabelclass2", "Alden Wq Retrofit (Proj #. 6758)")
      //
      // }).addTo(proj_6758_group);
      // var waterstation = L.marker(new L.latLng(45.4033159837, -122.7549400265), {
      //   icon: L.divIcon({
      //     className: 'fas fa-caret-up fa-2x station'
      //   })
      // }).addTo(waterstation_group);
      //
      //
      // var waterstation_label = L.marker(new L.LatLng(45.4038159837, -122.7519400265), {
      //   icon: createLabelIcon("textLabelclass", "<a href='https://waterdata.usgs.gov/usa/nwis/uv?site_no=14206950' target='_blank'>USGS Water Monitor @ Durham</a>")
      // }).addTo(waterstation_group);
      var overlays = {
        "<span style='color:red'>Zaatari Districts</span>": districts_group,
        '<span>Mosques</span> <i class="fas fa-mosque fa-lg control"></i> ': mosquesLayer,
        // '<span>Flow Gauges: </span> <i class="fas fa-water fa-lg flow_gauge"></i> ': flow_gauges,
        '<span>Garbage Bins</span><i class="fas fa-trash-alt fa-lg trash"></i>': trashLayer,
        "<span >Roads<hr></span>": roadsLayer,
        "<span >Septic Tanks</span>": sepTanksLayer,
        "<span >Septic Pipes</span>": sepPipesLayer,
        "<span >Steel Tanks</span>": steelTanksLayer,
        "<span >Solid Free Pipes</span>": steelPipesLayer,
        "<span >Camp Facilties</span>": faciltiesLayer,
      }
      L.control.layers(baseLayers, overlays, {
        collapsed: false
      }).addTo(mymap);
      var districtsLayer = L.geoJSON(districts, {
        style: style,
        onEachFeature: function(feature, layer) {
          layer.on({
            mouseover: highlightFeature,
            click: highlightFeature,
            mouseout: function(e) {
              districtsLayer.resetStyle(e.target);
            }
          });
        }
      }).addTo(districts_group);
      // var proj_141Layer = L.geoJSON(proj_141, {
      //   style: {
      //     opacity: 1,
      //     fillOpacity: 0.5,
      //     weight: 1,
      //     color: "green"
      //   },
      //   onEachFeature: function(feature, layer) {
      //     layer.on({
      //       mouseover: highlightFeature,
      //       click: highlightFeature,
      //       mouseout: function(e) {
      //         proj_141Layer.resetStyle(e.target);
      //       }
      //     });
      //   }
      // }).addTo(proj_141_group);
      //
      // var proj_1080Layer = L.geoJSON(proj_1080, {
      //   style: {
      //     opacity: 1,
      //     fillOpacity: 0.5,
      //     weight: 1,
      //     color: "blue"
      //   },
      //   onEachFeature: function(feature, layer) {
      //     layer.on({
      //       mouseover: highlightFeature,
      //       click: highlightFeature,
      //       mouseout: function(e) {
      //         proj_1080Layer.resetStyle(e.target);
      //       }
      //     });
      //   }
      // }).addTo(proj_1080_group);
      //
      // var proj_6758Layer = L.geoJSON(proj_6758, {
      //   style: {
      //     opacity: 1,
      //     fillOpacity: 0.5,
      //     weight: 1,
      //     color: "purple"
      //   },
      //   onEachFeature: function(feature, layer) {
      //     layer.on({
      //       mouseover: highlightFeature,
      //       click: highlightFeature,
      //       mouseout: function(e) {
      //         proj_6758Layer.resetStyle(e.target);
      //       }
      //     });
      //   }
      // }).addTo(proj_6758_group);
      // proj_123_group.bringToFront();
      // proj_141_group.bringToFront();
      // proj_1080_group.bringToFront();
      // proj_6758_group.bringToFront();
      function highlightFeature(e) {
        // e indicates the current event
        var layer = e.target; //the target capture the object which the event associates with
        layer.setStyle({
          weight: 1,
          opacity: 1,
          color: 'white',
          fillColor: 'mediumslateblue',
          fillOpacity: 0.8
        });
        $('#sidebar').addClass('active');
        $('#info').css('left', '420px');
        // $('.overlay').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        // projId = +e.target.feature.properties.PROJECT_ID;
        // projName = e.target.feature.properties.ProjectNam;
        Promise.all([
          d3.csv('assets/data.csv'),
          // d3.csv('assets/projs/Monitor' + projId + '.csv'),
        ]).then(function(datasets) {
          // $("#projName").text(projName);
          // // $("#projDesc").text(projDesc);
          // switch (projId) {
          //   case 141:
          //     $("#projImages").html("");
          //     $("#projImages").append(
          //       '<a href="img/141/PhotoPoints/HallToAsh-LeftBank3-Upstream-2008.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/141/PhotoPoints/HallToAsh-LeftBank3-Upstream-2008.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/141/PhotoPoints/HallToAsh-LeftBank3-Upstream-2010.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/141/PhotoPoints/HallToAsh-LeftBank3-Upstream-2010.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/141/PhotoPoints/HallToAsh-LeftBank3-Upstream-2016.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/141/PhotoPoints/HallToAsh-LeftBank3-Upstream-2016.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/141/PhotoPoints/HallToAsh-RightBank3-Downstream-2008.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/141/PhotoPoints/HallToAsh-RightBank3-Downstream-2008.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/141/PhotoPoints/HallToAsh-RightBank3-Downstream-2010.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/141/PhotoPoints/HallToAsh-RightBank3-Downstream-2010.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/141/PhotoPoints/HallToAsh-RightBank3-Downstream-2016.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/141/PhotoPoints/HallToAsh-RightBank3-Downstream-2016.jpg" class="img-fluid"></a>'
          //     );
          //     break;
          //   case 123:
          //     $("#projImages").html("");
          //     $("#projImages").append('<a href="img/123/Stream2005.png" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/123/Stream2005.png" class="img-fluid"></a>');
          //     $("#projImages").append('<a href="img/123/Stream2006.png" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/123/Stream2006.png" class="img-fluid"></a>');
          //     $("#projImages").append('<a href="img/123/Stream2011.png" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/123/Stream2011.png" class="img-fluid"></a>');
          //     $("#projImages").append('<a href="img/123/Stream2012.png" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/123/Stream2012.png" class="img-fluid"></a>');
          //     break;
          //   case 1080:
          //     $("#projImages").html("");
          //     $("#projImages").append(
          //       '<a href="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2007.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2007.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2008.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2008.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2013.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2013.jpg" class="img-fluid"></a>'
          //     );
          //     $("#projImages").append(
          //       '<a href="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2018.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/1080/PhotoPoints/Greenway-RightBank3-Upstream-2018.jpg" class="img-fluid"></a>'
          //     );
          //     break;
          //   case 6758:
          //     $("#projImages").html("");
          //     $("#projImages").append('<a href="img/6758/1.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/6758/1.jpg" class="img-fluid"></a>');
          //     $("#projImages").append('<a href="img/6758/2.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/6758/2.jpg" class="img-fluid"></a>');
          //     $("#projImages").append('<a href="img/6758/3.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/6758/3.jpg" class="img-fluid"></a>');
          //     $("#projImages").append('<a href="img/6758/4.jpg" data-toggle="lightbox" data-gallery="example-gallery" class="proj-img col-sm-3"><img src="img/6758/4.jpg" class="img-fluid"></a>');
          //     break;
          // }
          var ndx = crossfilter(datasets[0]); //passes the features to the crossfilter
          var ndx2 = crossfilter(datasets[1]); //passes the features to the crossfilter
          // groups everything together into one group, this is used to quickly search all of the data at once
          var all = ndx.groupAll();
          var all2 = ndx2.groupAll();
          //Takes each of the records of the dataset and returns each individual line so that they can be used. .dimension() puts
          // the data into an easily searchable/manipulable format for DC
          var everything = ndx.dimension(function(d) {
            return d
          });
          var everything2 = ndx2.dimension(function(d) {
            return d
          });
          //////////////////////////////////////////////SORT THE DATA///////////////////////////////////////////////////////////
          //Now that we have our initial data imported and in the right format using crossfilter we now have to sort out the data that we want to display, set up
          //the chart space and populate the graphs
          var stockDimension = ndx.dimension(function(d) {
            return d.StockType;
          });
          var speciesDimension = ndx.dimension(function(d) {
            return d.SpeciesType;
          });
          // //sorts through the data and finds the unit of each earthquake. Then returns a category based on the unit using the lamda operations
          var classDimension = ndx.dimension(function(d) {
            var unit = +d.Units;
            unitClass = ">=1000";
            if (unit < 50) {
              unitClass = '<50'
            } else if (unit >= 50 && unit <= 99) {
              unitClass = "50-99"
            } else if (unit >= 100 && unit <= 499) {
              unitClass = "100-499"
            } else if (unit >= 50 && unit <= 999) {
              unitClass = "500-999"
            } else {
              unitClass = ">=1000"
            }
            return unitClass
          });
          var classes = ["<50", "50-99", "100-499", "500-999", ">=1000"];
          var classOrdinal = d3.scaleOrdinal().domain(classes);
          var dateDimension = ndx.dimension(function(d) {
            return +d.PlantingYear
            // return d3.timeYear(new Date(+d.PlantingYear, 1, 1))
          });
          var dateDimension2 = ndx2.dimension(function(d) {
            //return d3.timeYear(new Date(+d.Year, 1, 1))
            return +d.Year
          });
          /////////////////////////////////////////GROUP THE DATA///////////////////////////////////////////////////////////////
          // Now that we have the id dimension captured in an object we have to group them all together so that we can use them
          var classDimensionGroup = classDimension.group();
          var dateDimensionGroup = dateDimension.group().reduceSum(function(d) {
            return +d.Units;
          });
          var dateDimensionGroup2 = dateDimension2.group().reduceSum(function(d) {
            return +d.SiteAssessmentStemsPerAcre;
          });
          var stockDimensionGroup = stockDimension.group().reduceSum(function(d) {
            return +d.Units;
          });
          var speciesDimensionGroup = speciesDimension.group().reduceSum(function(d) {
            return +d.Units;
          });
          /////////////////////////////////////CREATE THE CHARTS////////////////////////////////////////////////////////////////
          var classChart = dc.barChart('#class-chart');
          classChart
            .height(150)
            .x(classOrdinal)
            .xUnits(dc.units.ordinal)
            .brushOn(false)
            .dimension(classDimension)
            .group(classDimensionGroup)
            .elasticY(true)
            .xAxisLabel('Class')
            .yAxisLabel('# Plants')
            .yAxis().ticks(5);
          var stockChart = dc.pieChart('#stock-chart');
          stockChart
            .height(150)
            .width(150)
            // .innerRadius(50)
            .dimension(stockDimension)
            .group(stockDimensionGroup);
          var speciesChart = dc.pieChart('#species-chart');
          speciesChart
            .height(150)
            .width(150)
            .dimension(speciesDimension)
            .group(speciesDimensionGroup);
          // var dateChart = dc.lineChart('#date-chart');
          // dateChart
          //   .renderArea(true) //area or lines
          //   .height(150)
          //   .brushOn(true)
          //   .transitionDuration(1000) //how long it takes to transition
          //   .margins({
          //     top: 30,
          //     right: 50,
          //     bottom: 25,
          //     left: 40
          //   })
          //   .dimension(dateDimension)
          //   .group(dateDimensionGroup)
          //   .yAxisLabel('# Plants')
          //   .elasticY(true)
          //   // .controlsUseVisibility(true)
          //   .x(d3.scaleTime().domain([new Date(2005, 11, 1), new Date(2018, 1, 1)]))
          //   .yAxis().ticks(5); //timeDate object that has the format for the date
          var dateChart = dc.barChart('#date-chart');
          dateChart
            // .renderArea(true) //area or lines
            .height(150)
            // .brushOn(true)
            .transitionDuration(1000) //how long it takes to transition
            .margins({
              top: 30,
              right: 50,
              bottom: 25,
              left: 40
            })
            .dimension(dateDimension)
            .group(dateDimensionGroup)
            .yAxisLabel('# Plants')
            .elasticY(true)
            // .controlsUseVisibility(true)
            .x(d3.scaleOrdinal())
            .xUnits(dc.units.ordinal)
            .yAxis().ticks(5); //timeDate object that has the format for the date
          var dateChart2 = dc.barChart('#date-chart2');
          dateChart2
            // .renderArea(true) //area or lines
            .brushOn(false)
            .height(150)
            .transitionDuration(1000) //how long it takes to transition
            .margins({
              top: 30,
              right: 50,
              bottom: 25,
              left: 40
            })
            .dimension(dateDimension2)
            .group(dateDimensionGroup2)
            .yAxisLabel('# Plants')
            .elasticY(true)
            // .controlsUseVisibility(true)
            .x(d3.scaleOrdinal())
            .xUnits(dc.units.ordinal)
            .yAxis().ticks(5); //timeDate object that has the format for the date
          // const BAR_WIDTH= 20000000;
          //             dateChart2.on('preRedraw', function(chart) {
          //                   chart.width(chart.group().all().length * BAR_WIDTH);
          //               });
          var popCount = dc.dataCount('.dc-data-count'); //creates text depicting how many earthquakes are on screen, needs a <p> element
          popCount
            .dimension(ndx)
            .group(all) //since we're counting how many records we have we use the 'all' variable but we could have used any variable that had the total counts
            .html({
              some: '<strong>%filter-count</strong> selected out of <strong>%total-count</strong> records' +
                ' | <a href=\'javascript:dc.filterAll(); dc.renderAll();\'>Reset All</a>',
              all: 'All records selected. Please click on the graph or change the map view to apply filters.'
            });
          /////////////////////////////////////////DRAW ALL THE CHARTS//////////////////////////////////////////////////////////
          dc.renderAll(); //activates everything
          $("#date-chart2 svg").attr("fill", "none");
          $("#date-chart svg").attr("fill", "none");
          dateChart.on('filtered', function(chart, filter) {
            dateDimension2.filter(filter);
            dateDimension.filter(filter);
            dc.redrawAll();
            $("#date-chart svg").attr("fill", "none");
          });
          dateChart2.on('filtered', function(chart, filter) {
            dateChart.filter(filter);
            // speciesChart.filter(filter);
            dateDimension.filter(filter);
            // dateDimension2.filter(filter);
            // dateChart.redraw();
            dc.redrawAll();
            // $("#date-chart2 svg").attr("fill", "none");
          });
        });
      }
      // 3.2.2 zoom to the highlighted feature when the mouse is clicking onto it.
      function zoomToFeature(e) {
        mymap.fitBounds(e.target.getBounds());
      }
      //  var labels = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}@2x.png').addTo(mymap);
    });
    function road_style(feature) {
      var c = null;
      var w = 1;
      if (feature.properties.LINETYPE == "paved") {
        c = "grey";
        w = 1;
      } else {
        c = "brown";
        w = .75;
      }
      return {
        opacity: 0.7,
        color: c,
        weight: w
      };
    };
    colors = chroma.scale('YlOrRd').colors(7); //colors = chroma.scale('OrRd').colors(5);
    function setColor(density) {
      var id = 0;
      if (density > 8507) {
        id = 6;
      } else if (density > 7726 && density <= 8507) {
        id = 5;
      } else if (density > 6946 && density <= 7726) {
        id = 4;
      } else if (density > 6165 && density <= 6946) {
        id = 3;
      } else if (density > 5385 && density <= 6165) {
        id = 2;
      } else if (density > 4605 && density <= 5385) {
        id = 1;
      } else {
        id = 0;
      }
      return colors[id];
    }
    // 7. Set style function that sets fill color.md property equal to cell tower density
    function style(feature) {
      return {
        fillColor: setColor(feature.properties.totpop),
        fillOpacity: 0.4,
        weight: 2,
        opacity: 1,
        color: '#b4b4b4',
        dashArray: '4'
      };
    }
    facilityColors = chroma.scale('YlOrRd').colors(7); //colors = chroma.scale('OrRd').colors(5);
    function setfacilityColor(type) {
      var id = null;
      if (type == "Child Friendly Space") {
        id = 6;
      } else if (type == "Community Center") {
        id = 5;
      } else if (type == "Health") {
        id = 4;
      } else if (type == "Child Friendly Space") {
        id = 3;
      } else if (type == "Child Friendly Space") {
        id = 2;
      } else if (type == "Child Friendly Space") {
        id = 1;
      } else {
        id = 0;
      }
      return facilityColors[id];
    }
    // 7. Set style function that sets fill color.md property equal to cell tower density
    function facilityStyle(feature) {
      return {
        fillColor: setfacilityColor(feature.properties.totpop),
        fillOpacity: 0.4,
        weight: 2,
        opacity: 1,
        color: '#b4b4b4',
        dashArray: '4'
      };
    }
    $(".leaflet-control-attribution")
      .css("bottom", "60px")
      .css("background-color", "transparent")
      .html("Supported by <a href='http://geoviz.ceoas.oregonstate.edu'> GeoViz Lab @ Oregon State University </a>");
    $(document).on("click", '[data-toggle="lightbox"]', function(event) {
      event.preventDefault();
      $(this).ekkoLightbox();
    });
    d3.csv('assets/time.csv').then(function(dataset) {
      var t = ["t"];
      var totpop = ["Incoming Syrian Refugees"];
      dataset.forEach(function(d) {
        t.push(new Date(d["t"]))
        totpop.push((+d["total"]))
      });
      var chart = c3.generate({
        title: {
          // text: 'USGS Water Monitor @ Durham'
        },
        data: {
          x: "t",
          columns: [t, totpop],
          type: 'area-spline',
        },
        subchart: {
          show: true,
          // type: 'bar',
          size: {
            height: 15
          },
        },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b, %Y"
            }
          },
          y: {
            label: {
              text: 'Incoming Syrian Refugees',
              position: 'outer-middle'
            }
          },
        },
        point: {
          r: 0,
          focus: {
            expand: {
              r: 2
            }
          }
        },
        zoom: {
          // rescale: true,+
          enabled: true,
          type: "scroll",
        },
        legend: {
          show: false,
        },
        tooltip: {
          linked: true
        },
        bindto: "#totpop"
      });
      $($($("#totpop svg").children()[2]).children()[2]).find("text").hide()
    });
  </script>
</body>

</html>
